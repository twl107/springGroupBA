<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>설문 Meta 관리</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body>

<!-- 사이드바 -->
<div th:replace="~{admin/adminLeft :: sidebar}"></div>

<main class="admin-content">

  <button class="btn btn-outline-secondary d-lg-none mb-3" onclick="toggleSidebar()">☰ 메뉴</button>

  <!-- Header -->
  <div class="mb-4 d-flex justify-content-between align-items-center">
    <div>
      <h3 class="fw-bold mb-1">설문 Meta 관리</h3>
      <small class="text-secondary">등록된 설문(메타) 목록입니다.</small>
    </div>

    <a th:href="@{/admin/survey/meta/new}" class="btn btn-primary">
      + 새 설문 추가
    </a>
  </div>


  <!-- Table Card -->
  <div class="card shadow-sm p-3">

    <table class="table table-hover align-middle">
      <thead class="table-light">
      <tr>
        <th>ID</th>
        <th>설문 제목</th>
        <th>시작일</th>
        <th>종료일</th>
        <th style="width:200px; text-align:center;">관리</th>
      </tr>
      </thead>

      <tbody>
      <tr th:each="m : ${list}">
        <td th:text="${m.id}"></td>

        <td>
          <span class="fw-semibold" th:text="${m.title}"></span>
        </td>

        <td th:text="${#temporals.format(m.startDate, 'yyyy-MM-dd HH:mm')}"></td>
        <td th:text="${#temporals.format(m.endDate, 'yyyy-MM-dd HH:mm')}"></td>

        <td>
          <div class="d-flex justify-content-center gap-1">
            <!-- 문항관리 -->
            <a th:href="@{'/admin/survey/' + ${m.id} + '/questions'}"
               class="btn btn-outline-primary btn-sm">
              문항
            </a>

            <!-- 통계 -->
            <a th:href="@{'/admin/survey/stats/' + ${m.id}}"
               class="btn btn-outline-secondary btn-sm">
              통계
            </a>

            <!-- 활성/비활성 토글 -->
            <form th:action="@{'/admin/survey/meta/toggle/' + ${m.id}}"
                  method="post"
                  style="display:inline;">
              <button class="btn btn-sm"
                      th:classappend="${m.active == 'Y'} ? 'btn-success' : 'btn-secondary'">
                <span th:text="${m.active == 'Y'} ? '활성' : '비활성'"></span>
              </button>
            </form>

            <!-- 삭제 -->
            <form th:action="@{'/admin/survey/meta/delete/' + ${m.id}}"
                  method="post"
                  style="display:inline;">
              <button type="submit"
                      class="btn btn-outline-danger btn-sm"
                      onclick="return confirm('삭제하시겠습니까?');">
                삭제
              </button>
            </form>
          </div>
        </td>
      </tr>
      </tbody>
    </table>

  </div>

</main>

<script>
  function toggleSidebar() {
    document.querySelector('.admin-sidebar').classList.toggle('active');
  }
</script>

</body>
</html>
