<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>지원자 관리 - 관리자</title>

  <!-- BOOTSTRAP -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <link rel="stylesheet" th:href="@{/css/admin.css}">

  <script th:inline="javascript">
    const ctx = /*[[@{/}]]*/ "/";
  </script>
</head>
<body>

<div th:replace="~{admin/adminLeft :: sidebar}"></div>

<main class="admin-content">

  <!-- 모바일 사이드 버튼 -->
  <button class="btn btn-outline-secondary mb-3 d-lg-none" onclick="toggleSidebar()">☰ 메뉴</button>

  <!-- 제목 -->
  <div class="d-flex justify-content-between align-items-end mb-4">
    <div>
      <h3 class="fw-bold mb-1">지원자 관리</h3>
      <small class="text-secondary">지원자 목록입니다.</small>
    </div>
  </div>

  <!-- 필터 버튼 -->
  <div class="mb-3">
    <a th:href="@{'/admin/recruit/applicants?status=전체'}"
       class="btn btn-outline-success btn-sm"
       th:classappend="${status=='전체' or status==null} ? ' active' : ''">전체</a>

    <a th:href="@{'/admin/recruit/applicants?status=검토중'}"
       class="btn btn-outline-warning btn-sm"
       th:classappend="${status=='검토중'} ? ' active' : ''">검토중</a>

    <a th:href="@{'/admin/recruit/applicants?status=합격'}"
       class="btn btn-outline-primary btn-sm"
       th:classappend="${status=='합격'} ? ' active' : ''">합격</a>

    <a th:href="@{'/admin/recruit/applicants?status=불합격'}"
       class="btn btn-outline-danger btn-sm"
       th:classappend="${status=='불합격'} ? ' active' : ''">불합격</a>
  </div>

  <div class="d-flex align-items-center mb-3">
    <span class="text-muted me-2">직무:</span>
    <select class="form-select form-select-sm"
            style="width: 200px;"
            onchange="changePosition(this.value)">

      <option value="전체"
              th:selected="${position == null or position == '전체'}">전체</option>

      <option value="백엔드 개발자"
              th:selected="${position == '백엔드 개발자'}">백엔드 개발자</option>

      <option value="프론트 개발자"
              th:selected="${position == '프론트 개발자'}">프론트 개발자</option>

      <option value="임베디드 개발자"
              th:selected="${position == '임베디드 개발자'}">임베디드 개발자</option>

      <option value="AI 개발자"
              th:selected="${position == 'AI 개발자'}">AI 개발자</option>

      <option value="IoT 개발자"
              th:selected="${position == 'IoT 개발자'}">IoT 개발자</option>
    </select>
  </div>


  <!-- 선택 삭제 -->
  <form method="post" th:action="@{/admin/recruit/applicants/delete}">
    <div class="mb-2">
      <button type="submit" class="btn btn-danger btn-sm"
              onclick="return confirm('선택한 지원자를 삭제할까요?');">
        선택삭제
      </button>
    </div>

    <!-- 테이블 -->
    <table class="table table-hover table-bordered align-middle">
      <thead class="table-light">
      <tr>
        <th style="width:45px;"><input type="checkbox" onclick="toggleCheckAll(this)"></th>
        <th>ID</th>
        <th>이름</th>
        <th>연락처</th>
        <th>이메일</th>
        <th>지원일</th>
        <th>직무</th>
        <th>상태</th>
        <th>메모</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="a : ${applicantPage.content}">
        <td><input type="checkbox" name="ids" th:value="${a.id}"></td>
        <td th:text="${a.id}"></td>

        <td>
          <a th:href="@{'/admin/recruit/applicants/' + ${a.id}}"
             class="text-primary fw-bold"
             th:text="${a.name}">
          </a>
        </td>

        <td th:text="${a.phone}"></td>
        <td th:text="${a.email}"></td>

        <td th:text="${#temporals.format(a.createdAt, 'yyyy-MM-dd HH:mm')}"></td>

        <td th:text="${a.position}"></td>

        <td>
          <span class="fw-bold"
                th:style="${a.status=='합격' ? 'color:#0d6efd' :
                          (a.status=='불합격' ? 'color:#dc3545' :
                          'color:#e0a800')}">
             [[${a.status}]]
          </span>
        </td>

        <td>
          <span th:if="${a.adminMemo == null}">-</span>
          <span th:if="${a.adminMemo != null}">
              <span th:text="${a.adminMemo.length() > 30 ?
                             a.adminMemo.substring(0, 30) :
                             a.adminMemo}"></span>
              <span th:if="${a.adminMemo.length() > 30}">...</span>
          </span>
        </td>
      </tr>
      </tbody>
    </table>
  </form>

  <!-- 페이징 -->
  <nav>
    <ul class="pagination pagination-sm justify-content-center mt-3">
      <li th:each="i : ${#numbers.sequence(0, applicantPage.totalPages - 1)}"
          class="page-item"
          th:classappend="${i == currentPage} ? 'active'">
        <a class="page-link"
           th:href="@{/admin/recruit/applicants(page=${i})}"
           th:text="${i + 1}">
        </a>
      </li>
    </ul>
  </nav>

  <input type="hidden" id="th_page"    th:value="${currentPage}">
  <input type="hidden" id="th_status"  th:value="${status}">

</main>


<script>
  function toggleSidebar() {
    document.querySelector('.admin-sidebar').classList.toggle('active');
  }

  function toggleCheckAll(master) {
    document.querySelectorAll('input[name="ids"]').forEach(chk => {
      chk.checked = master.checked;
    });
  }

  function changePosition(pos) {
    const page = document.getElementById('th_page').value || 0;
    const status = document.getElementById('th_status').value || '전체';

    const url = `${ctx}admin/recruit/applicants?page=${page}&status=${encodeURIComponent(status)}&position=${encodeURIComponent(pos)}`;
    window.location.href = url;
  }
</script>

</body>
</html>
