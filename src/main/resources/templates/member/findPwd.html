<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>비밀번호 찾기</title>

  <th:block th:insert="~{include/bs5}"></th:block>
  <link rel="stylesheet" th:href="@{/css/layout.css}">
  <link rel="stylesheet" th:href="@{/css/member/main.css}">

  <style>
    body {
      background-color: #f8f9fa;
      font-family: 'Noto Sans KR', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .page-card {
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      padding: 2rem;
      width: 100%;
      max-width: 420px;
    }

    h2 {
      font-weight: 700;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    label {
      font-weight: 600;
      margin-bottom: 6px;
    }

    .form-control {
      border-radius: 10px;
      height: 45px;
    }

    .btn {
      width: 100%;
      height: 45px;
      border-radius: 10px;
      font-weight: 600;
    }

    .spinner-border {
      width: 1rem;
      height: 1rem;
    }
  </style>

  <script th:inline="javascript">
    $(document).ready(function() {
        $("#sendReset").click(function() {
            const url = $(this).data("url");
            const mid = $("#mid").val().trim();
            const email = $("#email").val().trim();

            if (mid === "" || email === "") {
                alert("아이디와 이메일을 모두 입력해주세요.");
                return;
            }

            const $btn = $(this);
            $btn.prop("disabled", true);
            $("#resetText").hide();
            $("#resetSpinner").removeClass("d-none");

            $.ajax({
                url: url,
                type: "POST",
                data: { mid: mid, email: email },
                beforeSend: function(xhr) {
                    const token = $("meta[name='_csrf']").attr("content");
                    const header = $("meta[name='_csrf_header']").attr("content");
                    xhr.setRequestHeader(header, token);
                },
                success: function(res) {
                    alert(res);
                    $("#mid").val('');
                    $("#email").val('');
                },
                error: function(xhr) {
                    alert(xhr.responseText || "오류가 발생했습니다.");
                },
                complete: function() {
                    $btn.prop("disabled", false);
                    $("#resetSpinner").addClass("d-none");
                    $("#resetText").show();
                }
            });
        });
    });
  </script>

  <!-- CSRF -->
  <meta th:name="_csrf" th:content="${_csrf.token}" />
  <meta th:name="_csrf_header" th:content="${_csrf.headerName}" />
</head>

<body>

<div th:replace="~{include/header :: header}"></div>
<div th:replace="~{include/message :: alertMessage}"></div>

<div class="page-card">
  <h2>비밀번호 찾기</h2>

  <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
  <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

  <form id="findPwdForm">
    <div class="mb-3">
      <label for="mid">아이디</label>
      <input type="text" id="mid" name="mid" class="form-control" placeholder="가입한 아이디" required>
    </div>

    <div class="mb-3">
      <label for="email">이메일</label>
      <input type="text" id="email" name="email" class="form-control" placeholder="가입한 이메일" required>
    </div>

    <button type="button" id="sendReset" class="btn btn-primary w-100 mt-2" th:data-url="@{/member/findPwd}">
      <span id="resetText">이메일 전송</span>
      <span id="resetSpinner" class="spinner-border spinner-border-sm d-none ms-2" role="status"></span>
    </button>

    <a th:href="@{/member/memberLogin}" class="btn btn-secondary mt-3">돌아가기</a>
  </form>
</div>

</body>
</html>
