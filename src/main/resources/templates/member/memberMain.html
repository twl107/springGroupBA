<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ë§ˆì´í˜ì´ì§€</title>

  <script th:inline="javascript">
    /*<![CDATA[*/
    const contextPath = /*[[@{/}]]*/ "/";
    /*]]>*/
  </script>

  <!-- Bootstrap + jQuery -->
  <th:block th:insert="~{include/bs5}"></th:block>
  <link rel="stylesheet" th:href="@{/css/layout.css}">
  <link rel="stylesheet" th:href="@{/css/member/main.css}">

  <style>
    .mypage-container {
      max-width: 720px;
      margin: 90px auto 35px auto !important;
    }

    .profile-img {
      width: 180px;
      height: 180px;
      object-fit: cover;
      border-radius: 50%;
      border: 3px solid #ddd;
      display: block;
      margin: auto;
    }

    .info-table p {
      margin: 6px 0;
      font-size: 16px;
    }

    .btn-block {
      width: 100%;
      height: 45px;
      font-weight: 600;
      border-radius: 8px;
    }
  </style>

  <script th:inline="javascript">
    function memberDelete() {
      if (confirm("íšŒì› íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        if (confirm("íƒˆí‡´í•˜ì‹œë©´ 1ì£¼ì¼ê°„ ê°™ì€ ì•„ì´ë””ë¡œ ë‹¤ì‹œ ê°€ì…í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          document.getElementById('memberDelete').submit();
        }
      }
    }

    document.addEventListener("DOMContentLoaded", function() {
      const img = document.querySelector('.previewImg');
      if(img) {
        img.src = img.src.split("?")[0] + "?v=" + new Date().getTime();
      }
    });

    // ì„¤ë¬¸ íŒì—… ì—´ê¸°
    function openSurveyPopup(id) {
      const w = 700;
      const h = 800;
      const left = (window.innerWidth - w) / 2;
      const top = (window.innerHeight - h) / 2;

      window.open(`${contextPath}survey/start/${id}`,
        "surveyPopup",
        `width=${w},height=${h},top=${top},left=${left}`);
    }
  </script>
</head>

<body>
<div th:replace="~{include/header :: header}"></div>
<div th:replace="~{include/message :: alertMessage}"></div>

<div class="container mypage-container mt-5">
  <!-- í”„ë¡œí•„ ì‚¬ì§„ -->
  <div class="text-center">
    <img th:src="@{${photoUrl}}"
         th:alt="${loginMember.name + ' í”„ë¡œí•„'}"
         class="profile-img previewImg"/>
  </div>

  <!-- ê°œì¸ì •ë³´ -->
<!--  <div class="card mt-4 shadow-sm">-->
<!--    <div class="card-header bg-primary text-white text-center">-->
<!--      <strong>ê°œì¸ì •ë³´</strong>-->
<!--    </div>-->
<!--    <div class="card-body info-table">-->
<!--      <p><strong>ì´ë¦„ :</strong> [[${loginMember.name}]]</p>-->
<!--      <p><strong>ì•„ì´ë”” :</strong> [[${loginMember.mid}]]</p>-->
<!--      <p><strong>ì´ë©”ì¼ :</strong> [[${loginMember.email}]]</p>-->
<!--      <p><strong>ì „í™”ë²ˆí˜¸ :</strong> [[${loginMember.tel}]]</p>-->
<!--      <p><strong>ìƒë…„ì›”ì¼ :</strong> [[${loginMember.birthday}]]</p>-->
<!--      <p><strong>ì£¼ì†Œ :</strong> [[${loginMember.address}]]</p>-->
<!--      <p><strong>ì„±ë³„ :</strong> [[${loginMember.gender}]]</p>-->
<!--      <p><strong>ê°€ì…ì¼ :</strong> [[${#temporals.format(loginMember.joinDate, 'yyyy-MM-dd')}]]</p>-->
<!--      <p><strong>ë“±ê¸‰ :</strong> [[${loginMember.role.label}]]</p>-->
<!--    </div>-->
<!--  </div>-->

  <!-- ìµœê·¼ ë©”ì‹œì§€ -->
  <div class="card mt-4 shadow-sm">
    <div class="card-header bg-success text-white">
      <strong>ìµœê·¼ ë©”ì‹œì§€</strong>
    </div>

    <div class="card-body">
      <!-- ìƒˆ ë©”ì‹œì§€ -->
      <p class="fw-bold">ğŸ“¨ ìƒˆ ë©”ì‹œì§€</p>
      <ul class="list-group mb-3">
        <li th:each="msg : ${newMsgList}" class="list-group-item">
          <span th:text="${msg.title}"></span>
          <span class="text-muted float-end" th:text="${#temporals.format(msg.sendDate, 'yyyy-MM-dd HH:mm')}"></span>
        </li>
        <li th:if="${#lists.isEmpty(newMsgList)}" class="list-group-item text-muted">
          ìƒˆ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.
        </li>
      </ul>

      <!-- ìµœê·¼ ë°›ì€ ë©”ì‹œì§€ -->
      <p class="fw-bold">ğŸ“¥ ë°›ì€ ë©”ì‹œì§€</p>
      <ul class="list-group mb-3">
        <li th:each="msg : ${receiveMsgList}" class="list-group-item">
          <span th:text="${msg.title}"></span>
          <span class="text-muted float-end" th:text="${#temporals.format(msg.sendDate, 'yyyy-MM-dd HH:mm')}"></span>
        </li>
        <li th:if="${#lists.isEmpty(receiveMsgList)}" class="list-group-item text-muted">
          ë°›ì€ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.
        </li>
      </ul>

      <!-- ìµœê·¼ ë³´ë‚¸ ë©”ì‹œì§€ -->
      <p class="fw-bold">ğŸ“¤ ë³´ë‚¸ ë©”ì‹œì§€</p>
      <ul class="list-group mb-3">
        <li th:each="msg : ${sendMsgList}" class="list-group-item">
          <span th:text="${msg.title}"></span>
          <span class="text-muted float-end" th:text="${#temporals.format(msg.sendDate, 'yyyy-MM-dd HH:mm')}"></span>
        </li>
        <li th:if="${#lists.isEmpty(sendMsgList)}" class="list-group-item text-muted">
          ë³´ë‚¸ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.
        </li>
      </ul>

      <a th:href="@{/webMessage/msg}" class="btn btn-outline-success btn-block mb-2">
        ì „ì²´ ë©”ì‹œì§€ ë³´ê¸°
      </a>
    </div>
  </div>


  <!-- FAQ -->
  <!--  <div class="card mt-4 shadow-sm">-->
  <!--    <div class="card-header bg-info text-white">-->
  <!--      <strong>FAQ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</strong>-->
  <!--    </div>-->

  <!--    <div class="accordion" id="faqAccordion">-->
  <!--      <div class="accordion-item" th:each="faq, stat : ${faqList}">-->
  <!--        <h2 class="accordion-header" th:attr="id='faqHead' + ${stat.index}">-->
  <!--          <button class="accordion-button collapsed" type="button"-->
  <!--                  data-bs-toggle="collapse"-->
  <!--                  th:attr="data-bs-target='#faqBody' + ${stat.index}">-->
  <!--            <span th:text="${faq.question}"></span>-->
  <!--          </button>-->
  <!--        </h2>-->
  <!--        <div th:attr="id='faqBody' + ${stat.index}"-->
  <!--             class="accordion-collapse collapse"-->
  <!--             th:attrappend="data-bs-parent='#faqAccordion'">-->
  <!--          <div class="accordion-body">-->
  <!--            <span th:text="${faq.answer}"></span>-->
  <!--          </div>-->
  <!--        </div>-->
  <!--      </div>-->
  <!--      &lt;!&ndash; FAQ ì—†ì„ ì‹œ &ndash;&gt;-->
  <!--      <div class="p-3 text-muted" th:if="${#lists.isEmpty(faqList)}">-->
  <!--        ë“±ë¡ëœ FAQê°€ ì—†ìŠµë‹ˆë‹¤.-->
  <!--      </div>-->
  <!--    </div>-->
  <!--  </div>-->

  <!-- ì„¤ë¬¸ì¡°ì‚¬ ì˜ì—­ -->
  <div class="card mt-4 shadow-sm">
    <div class="card-header bg-warning text-dark">
      <strong>ğŸ“Š ì§„í–‰ì¤‘ì¸ ì„¤ë¬¸ì¡°ì‚¬</strong>
    </div>

    <div class="card-body">

      <div th:if="${#lists.isEmpty(surveyList)}" class="text-muted">
        í˜„ì¬ ì°¸ì—¬ ê°€ëŠ¥í•œ ì„¤ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.
      </div>

      <div th:each="m : ${surveyList}"
           class="p-2 border rounded mb-2 d-flex justify-content-between align-items-center">

        <div class="fw-semibold" th:text="${m.title}"></div>

        <!-- ì´ë¯¸ ì°¸ì—¬í•œ ê²½ìš° -->
        <button th:if="${submitMap[m.id]}"
                class="btn btn-secondary btn-sm"
                onclick="alert('ì´ë¯¸ ì°¸ì—¬í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤ ğŸ˜Š');">
          ì´ë¯¸ ì°¸ì—¬ ì™„ë£Œ
        </button>

        <!-- ì•„ì§ ì°¸ì—¬ ì•ˆí•œ ê²½ìš° -->
        <button th:if="${!submitMap[m.id]}"
                class="btn btn-primary btn-sm"
                th:onclick="|openSurveyPopup(${m.id})|">
          ì°¸ì—¬í•˜ê¸°
        </button>

      </div>

    </div>
  </div>


  <div class="mt-4">
    <a th:href="@{/member/memberPwdCheck/u}" class="btn btn-outline-primary btn-block mb-2">
      íšŒì›ì •ë³´ ìˆ˜ì •
    </a>

    <a th:href="@{/member/memberPwdCheck/p}" class="btn btn-outline-warning btn-block mb-2">
      ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
    </a>

    <a th:href="@{/webMessage/msg}" class="btn btn-outline-success btn-block mb-2">
      ì›¹ ë©”ì‹œì§€
    </a>

    <form id="memberDelete" th:action="@{/member/memberDelete}" method="post">
      <input type="hidden" name="_csrf" th:value="${_csrf.token}">
      <button type="button" class="btn btn-danger btn-block mt-3" onclick="memberDelete()">
        íšŒì› íƒˆí‡´
      </button>
    </form>
  </div>
</div>

<div th:replace="~{include/footer :: footer}"></div>
</body>

</html>
